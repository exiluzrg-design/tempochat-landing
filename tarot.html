<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Tarot IA — Tirada en U</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    html, body{
      height:100%;
      margin:0;
      background: radial-gradient(2000px 1400px at 50% 45%, #5f3bb8 0%, #3b1a77 45%, #1a083a 100%);
      color:#fff;
      overflow:hidden;
    }
    .screen{
      min-height:100vh;
      width:100vw;
      display:flex;
      align-items:center;
      justify-content:center;
      flex-direction:column; /* para que abajo se vea la imagen test */
      gap:20px;
    }
    .stage{
      width:min(1280px,95vw);
      height:min(720px,80vh);
      position:relative;
      overflow:hidden;
      background: transparent;
    }
    :root{ --card-w:128px; --card-h:204px; }
    .card{
      position:absolute; width:var(--card-w); height:var(--card-h);
      border-radius:14px; overflow:hidden;
      transform-origin:50% 85%;
      opacity:0; transform:translateY(110vh) rotate(0deg);
      transition-property:transform,opacity;
      transition-duration:.9s;
      transition-timing-function:cubic-bezier(.2,.8,.2,1);
      background:#000;
    }
    .card.show{ opacity:1; }
    .card img{
      position:absolute; inset:0;
      width:100%; height:100%;
      object-fit: cover;
    }
  </style>
</head>
<body>
  <div class="screen">
    <div id="root"></div>

    <!-- Imagen de prueba -->
    <div>
      <p>Imagen de prueba desde /public/test.png:</p>
      <img src="/test.png" alt="Imagen de prueba" width="150"/>
    </div>
  </div>

  <script type="text/babel" data-presets="react">
    const { useEffect, useMemo, useRef, useState } = React;
    const CARD_COUNT = 5; // menos para probar rápido
    const CARD_W = 128, CARD_H = 204;

    function CardBack(){
      return <img src="/card-back.png" alt="Dorso carta de tarot" />;
    }

    function computeLayout(count){
      const out=[];
      const cx=600, cy=250, rx=400, ry=200;
      for(let i=0;i<count;i++){
        const t=i/(count-1), ang=Math.PI - t*Math.PI;
        const x=cx+rx*Math.cos(ang);
        const y=cy+ry*Math.sin(ang);
        let rot=(ang*180/Math.PI)-90;
        out.push({left:x-CARD_W/2, top:y-CARD_H/2, rot});
      }
      return out;
    }

    function TarotU(){
      const layout = useMemo(()=>computeLayout(CARD_COUNT), []);
      const refs=useRef([]);

      useEffect(()=>{
        refs.current.forEach((el,i)=>{
          if(!el) return;
          el.classList.remove('show');
          const {left,top,rot}=layout[i];
          el.style.left=left+"px";
          el.style.top=top+"px";
          el.style.transform=`translateY(110vh) rotate(${rot-20}deg)`;
        });
        requestAnimationFrame(()=>{
          refs.current.forEach(el=>el?.getBoundingClientRect());
          requestAnimationFrame(()=>{
            refs.current.forEach((el,i)=>{
              if(!el) return;
              const {rot}=layout[i];
              setTimeout(()=>{
                el.classList.add('show');
                el.style.transform=`translateY(0) rotate(${rot}deg)`;
              }, i*150);
            });
          });
        });
      }, [layout]);

      return (
        <div className="stage">
          {layout.map((pos,i)=>(
            <div key={i} ref={el=>refs.current[i]=el} className="card" style={{left:pos.left, top:pos.top}}>
              <CardBack/>
            </div>
          ))}
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<TarotU/>);
  </script>
</body>
</html>
